<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RÃ©capitulatif des choix</title>
    <style>
        
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background-color: #f0f5f9;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Calibri', Arial, sans-serif;
        }

        
        .container {
            width: 90%;
            height: 90vh;
            background-color: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
            border-radius: 10px;
            overflow: auto;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

       
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #1a5276;
            padding-bottom: 15px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .header h1 {
            color: #004056;
            margin: 0;
            font-size: 28px;
            font-weight: bold;
            animation: fadeIn 1.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        
        .notification-bell {
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
        }

        .bell-icon {
            width: 40px;
            height: 40px;
            transition: transform 0.3s ease;
        }

        .bell-icon:hover {
            transform: scale(1.1);
        }

        .notification-badge {
            position: absolute;
            top: 0px;
            right: 0px;
            background-color: red;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            font-weight: bold;
        }

       
        @keyframes ring {
            0% { transform: rotate(0); }
            25% { transform: rotate(10deg); }
            50% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
            100% { transform: rotate(0); }
        }

        .bell-shake {
            animation: ring 0.5s ease-in-out;
        }

        
        .notifications-panel {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            padding: 15px;
            position: absolute;
            top: 70px;
            right: 20px;
            width: 300px;
            z-index: 100;
            display: none;
        }

        .notifications-panel h2 {
            color: #004056;
            font-size: 18px;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        
        .notification {
            border-bottom: 1px solid #ddd;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s;
        }

        .notification:hover {
            background-color: #f5f5f5;
        }

        .notification:last-child {
            border-bottom: none;
        }

        .notification.unread::before {
            content: '';
            width: 10px;
            height: 10px;
            background-color: red;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .notification span {
            font-size: 14px;
            color: #333;
        }

        
        .mark-read-btn {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.3s ease-in-out;
        }

        .mark-read-btn:hover {
            background-color: #0056b3;
        }

        
        .info-section {
            margin-top: 30px;
            text-align: center;
        }

        
        .message-box {
            display: none;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: black;
            background-color: rgba(180, 214, 228, 0.5);
            border: 2px solid #35373a;
            padding: 15px;
            margin: 0 auto 30px;
            width: 80%;
            border-radius: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(12, 11, 11, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(139, 0, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 0, 0, 0); }
        }
        .message-box.accepted {
            color: white;
            background-color: rgba(0, 128, 0, 0.7); /* greenish background */
            border: 2px solid #006400; /* dark green border */
            animation: pulseGreen 2s infinite;
        }

        @keyframes pulseGreen {
            0% { box-shadow: 0 0 0 0 rgba(0, 100, 0, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 100, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 100, 0, 0); }
        }

       
        .centered-title {
            font-size: 32px;
            font-weight: bold;
            color: #004056;
            margin-bottom: 20px;
            position: relative;
            display: inline-block;
        }

        .centered-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 10%;
            width: 80%;
            height: 3px;
            background-color: #1a5276;
            border-radius: 2px;
        }

        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background-color: #ffffff;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        
        th {
            background-color: #1a5276;
            color: white;
            padding: 15px;
            font-size: 16px;
            border: 1px solid #1a5276;
            position: relative;
        }

        th:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: rgba(255,255,255,0.3);
        }

      
        td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
            color: #333;
            transition: all 0.2s;
        }

        
        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tbody tr:hover {
            background-color: #d4e6f1;
            transform: scale(1.01);
        }

        
        .stats-cards {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .stat-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            padding: 15px;
            width: 23%;
            min-width: 200px;
            margin-bottom: 20px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stat-title {
            color: #1a5276;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #004056;
        }

        
        .divider {
            height: 3px;
            background: linear-gradient(to right, #1a5276, #d4e6f1, #1a5276);
            margin: 30px 0;
            border-radius: 2px;
        }

        
        .footer {
            margin-top: auto;
            text-align: center;
            padding: 15px 0;
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 14px;
        }

      
        .badge {
            display: inline-block;
            padding: 5px 10px;
            background-color: #d4e6f1;
            color: #1a5276;
            border-radius: 15px;
            font-size: 14px;
            margin: 5px;
        }

        .badges-container {
            text-align: center;
            margin: 20px 0;
        }

       
        .help-section {
            background-color: #f5f9fc;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #1a5276;
        }

        .help-title {
            color: #004056;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .help-text {
            color: #333;
            font-size: 14px;
            line-height: 1.5;
        }

        
        .semester-selector {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .semester-btn {
            background-color: #f5f9fc;
            color: #1a5276;
            border: 2px solid #1a5276;
            padding: 10px 20px;
            margin: 0 10px;
            font-size: 16px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .semester-btn:hover {
            background-color: #d4e6f1;
        }

        .semester-btn.active {
            background-color: #1a5276;
            color: white;
        }

        .semester-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .semester-content.active {
            display: block;
        }

        .animated-title {
            animation: fadeIn 1.5s ease-in-out;
        }
        .negotiation-box {
            border: 1px solid #ccc;
            padding: 1em;
            margin-top: 2em;
            margin-bottom: 2em;
            background-color: #f9f9f9;
        }

        .negotiation-item {
            padding: 15px 20px;
            margin-bottom: 15px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(26, 75, 165, 0.1);
            transition: box-shadow 0.3s ease;
        }

        .negotiation-item:hover {
            box-shadow: 0 6px 16px rgba(26, 75, 165, 0.2);
        }

        .negotiation-buttons {
            margin-top: 10px;
        }

        .negotiation-buttons button {
            background-color: #1a4ba5;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 14px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-right: 10px;
        }

        .negotiation-buttons button:hover {
            background-color: #163b84;
        }
        #Nnegociations{
            display: none;
        }
        .action-buttons-wrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 16px;
            margin: 30px 0;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 40px auto;
            padding: 20px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 600;
            text-decoration: none;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            transform: translateY(0);
            background: linear-gradient(135deg, #e6f0f8, #f9fbfd);
            color: #0b3d6d;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
        }

        .btn-update {
            background: linear-gradient(135deg, #1a5276, #2471a3);
            color: #ffffff;
        }

        .btn-update:hover {
            background: linear-gradient(135deg, #134266, #1a5276);
        }

        .btn-chat {
            background: linear-gradient(135deg, #0056b3, #1b74d1);
            color: #ffffff;
        }

        .btn-chat:hover {
            background: linear-gradient(135deg, #003d80, #0056b3);
        }

        /* Modal pour la nÃ©gociation */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 50px auto;
            padding: 25px;
            border-radius: 5px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            position: relative;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #777;
        }

        .close:hover {
            color: #333;
        }

        .modal-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .modal-title {
            font-size: 20px;
            color: #004056;
            margin: 0;
        }

        .negotiation-section {
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group textarea {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Calibri', Arial, sans-serif;
            min-height: 100px;
            margin:8px 0;
            resize: vertical;
        }
        .form-group textarea:focus {
            outline: none;
            border-color: #0077cc;
            box-shadow: 0 0 0 3px rgba(0, 119, 204, 0.2);
        }
        .form-group input, 
        .form-group select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Calibri', Arial, sans-serif;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-column {
            flex: 1;
        }

        .module-selection {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
        }

        .module-checkbox {
            display: flex;
            align-items: center; 
            gap: 12px; 
            width: 50px;
        }

        .module-checkbox input {
            margin: 0;
            flex-shrink: 0; 
        }

        .module-checkbox label {
            flex-grow: 1; 
            white-space: nowrap;
        }

        .modal-footer {
            margin-top: 25px;
            display: flex;
        }
       .conversation-btn {
            background-color: #0056b3;
            color: #ffffff;
            border: none;
            padding: 10px 20px;
            font-size: 15px;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 86, 179, 0.2);
            margin: 16px auto;
        }

        .conversation-btn:hover {
            background-color: #003d80;
            transform: translateY(-2px);
        }

        .message-left {
            text-align: left;
            background-color: #e0f7fa; /* style pour teacher */
            color: #006064;
            padding: 8px 12px;
            border-radius: 10px;
            max-width: 60%;
            margin: 6px 0;
            align-self: flex-start;
        }

        .message-right {
            text-align: left;
            background-color: #c8e6c9; /* style pour chef */
            color: #256029;
            padding: 8px 12px;
            border-radius: 10px;
            max-width: 60%;
            margin: 6px 0;
            align-self: flex-end;
        }
        .btn-send {
            background-color: #0077cc;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 15px;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .btn-send:hover {
            background-color: #005fa3;
        }
    </style>
</head>

<body>
    <div class="container">
        <header class="header">
            <h1 id="page-title" class="animated-title">RÃ©capitulatif des choix</h1>
            
        <!--<div class="notification-bell" onclick="toggleNotificationsPanel()">
                <img src="notifcloche.jpg" alt="Cloche de notification" class="bell-icon">
                <div class="notification-badge" id="notification-badge">!</div>
            </div>-->
        </header>
        
        <div id="Nnegociations">
            <div id="notification-box"></div>

            <div id="negotiations-section" class="negotiation-box">
                <h2>NÃ©gociations en attente</h2>
                <div id="negotiations-list"></div>
            </div>
        </div>
        <section class="info-section">
            
            <div class="message-box">
                VOUS AVEZ DÃJÃ FAIT VOTRE CHOIX !
            </div>
            
            
            <div class="info-header centered-title">Tableau RÃ©capitulatif</div>
            
            
            <div class="badges-container">
                <span class="badge">AnnÃ©e 2024-2025</span>
                <span class="badge stat">ValidÃ©</span>
            </div>
            
            
            <div class="semester-selector">
                <button class="semester-btn active" onclick="showSemester('semester1')">Semestre 1</button>
                <button class="semester-btn" onclick="showSemester('semester2')">Semestre 2</button>
            </div>
            
            
            <div id="semester1" class="semester-content active">
                <div class="info-content">
                    <table id="recap-table-s1">
                        <thead>
                            <tr>

                                <th>Modules</th>
                                <th>Types d'enseignement</th>
                                <th>Heures d'enseignement</th>
                            </tr>
                        </thead>
                        <tbody>
                            
                        </tbody>
                    </table>
                </div>
            </div>
            
            
            <div id="semester2" class="semester-content">
                <div class="info-content">
                    <table id="recap-table-s2">
                        <thead>
                            <tr>
                                
                                <th>Modules</th>
                                <th>Types d'enseignement</th>
                                <th>Heures d'enseignement</th>
                            </tr>
                        </thead>
                        <tbody>
                            
                        </tbody>
                    </table>
                </div>
            </div>
            
           
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-title">Total d'heures</div>
                    <div class="stat-value" id="total-hours">74h</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Modules </div>
                    <div class="stat-value" id="modules-validated">4/4</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Progression</div>
                    <div class="stat-value">100%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Date limite</div>
                    <div class="stat-value">30/08/25</div>
                </div>
            </div>
            <div class="action-buttons">
                <a href="voeu.html?mode=edit" class="btn btn-update">
                    ð Mettre Ã  jour votre voeu
                </a>
                <button class="btn btn-chat" onclick="openchat()">
                    ð¬ Consulter lâÃ©change avec le chef
                </button>
            </div>

            
            <div class="divider"></div>
            
           
            <div class="help-section">
                <div class="help-title">Besoin d'aide ?</div>
                <div class="help-text">
                   Pour toute question ou information complÃ©mentaire, vous pouvez contacter le responsable pÃ©dagogique par email Ã  <strong>finfo@usthb.dz</strong> ou par tÃ©lÃ©phone au <strong>+213 023934031</strong>.
                  
                </div>
            </div>
        </section>

        
        <div class="notifications-panel" id="notifications-panel">
            <h2>Vos Notifications</h2>
            <div id="notifications-container">
                
            </div>
        </div>

        
        <footer class="footer">
            Â© FacultÃ© d'Informatique - Tous droits rÃ©servÃ©s
        </footer>

    </div>
<!-- Modal de NÃ©gociation -->
    <div id="negotiateModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div class="modal-header">
                <h2 class="modal-title">NÃ©gociation du VÅu</h2>
            </div>
            <div class="negotiation-section">
                <div class="form-group">
                    <label for="negotiation-message">RÃ©ponse au chef de dÃ©partement :</label>
                    <textarea id="negotiation-message" placeholder="Saisissez votre rÃ©ponse ou commentaire ici..."></textarea>
                    <div style="text-align: right; margin-top: 5px;">
                        <button class="btn-send" onclick="">Envoyer la rÃ©ponse</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Messages Ã©changÃ©s :</label>
                    <div class="module-selection">
                          
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
let currentUserId = null; // variable globale pour stocker l'ID utilisateur
let totalHoursS1 = 0;
let totalHoursS2 = 0;
let selectedTeacherId = null;

console.log(currentUserId);
const token = localStorage.getItem('token');
//let selectedTeacherId = null;

async function loadMessages() {
	const res = await fetch("/messages", {
		headers: {
			Authorization: `Bearer ${token}`
		},
	});
	const messages = await res.json();
	console.log(messages);
	const messagesDiv = document.querySelector(".module-selection");
	const currentUserId = parseInt(localStorage.getItem('currentUserId'));
	const filteredMessages = messages.filter(
		(msg) =>
		msg.receiver_id === currentUserId ||
		msg.sender_id === currentUserId,
	);
	filteredMessages.reverse();
	messagesDiv.innerHTML = "";
	if (filteredMessages.length === 0) {
		const noMsg = document.createElement("p");
		noMsg.textContent = "Aucune conversation disponible pour le moment.";
		noMsg.style.fontStyle = "italic";
		noMsg.style.color = "#888";
		messagesDiv.appendChild(noMsg);
	} else {

		filteredMessages.forEach((msg) => {
			const p = document.createElement("p");
			p.textContent = msg.content;

			if (msg.sender_id === currentUserId) {
				p.classList.add("message-right");
			} else {
				p.classList.add("message-left");
			}

			messagesDiv.appendChild(p);
		});
	}
}

window.onload = () => {
	const token = localStorage.getItem("token");
	if (!token) return window.location.href = "/login.html";

	fetch("/api/auth/profile", {
			headers: {
				"Authorization": `Bearer ${token}`,
				"Content-Type": "application/json"
			}
		})
		.then(res => {
			if (!res.ok) throw new Error("Non autorisÃ©");
			return res.json();
		})
		.then(data => {
			const u = data.user;
			currentUserId = u.id; 
			localStorage.setItem('currentUserId', currentUserId);
			fetchModuleData();
		})
		.catch(err => {
			console.error("Erreur de chargement:", err);
			window.location.href = "/loginsignup.html";
		});
}

document.querySelector('.btn-send').addEventListener('click', async (e) => {
	e.preventDefault();
	const storedUserId = localStorage.getItem('currentUserId');
	const input = document.getElementById('negotiation-message');
	if (!currentUserId) {
		alert("Aucun enseignant sÃ©lectionnÃ©.");
		return;
	}

	await fetch('/messages', {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json',
			'Authorization': `Bearer ${token}`
		},
		body: JSON.stringify({
			content: input.value,
			receiver_id: 1, // dynamic
			sender_id: storedUserId // chef de dÃ©partement
		})
	});

	input.value = '';
	loadMessages(); // Refresh messages
});


async function fetchModuleData() {
	if (!currentUserId) {
		console.warn("currentUserId non dÃ©fini, impossible de charger les modules");
		return;
	}

	try {
		const response = await fetch(`/voeumodules/${currentUserId}`);

		if (!response.ok) throw new Error('Erreur rÃ©seau');

		const data = await response.json();
		console.log(data);
		const messageBox = document.querySelector('.message-box');
		const Nnegociations = document.getElementById('Nnegociations');
		const stat = document.querySelector('.stat');
		const actionButtons = document.querySelector('.action-buttons');

		if (data.Vstatus === 'acceptÃ©') {
    actionButtons.style.display = 'none';
    messageBox.style.display = "block";
    messageBox.textContent = 'Votre choix a Ã©tÃ© acceptÃ©.';
    Nnegociations.style.display = 'none';
    stat.textContent = 'ValidÃ©';
    messageBox.classList.add('accepted');

} else if (data.Vstatus === 'en nÃ©gociation') {
    actionButtons.style.display = 'none';
    messageBox.style.display = "block";
    messageBox.textContent = 'Votre voeu est en nÃ©gociation avec le chef de dÃ©partement.';
    Nnegociations.style.display = 'block';
    stat.textContent = 'en nÃ©gociation'; // <-- ici le badge change
    messageBox.classList.remove('accepted');
    document.getElementById('Nnegociations').style.display = 'none';
    actionButtons.style.display = 'flex';
} else if (data.Vstatus === 'en attente') {
    messageBox.style.display = "block";
    messageBox.textContent = 'VOUS AVEZ DÃJÃ FAIT VOTRE CHOIX !';
    Nnegociations.style.display = 'none';
    stat.textContent = 'en attente';
    messageBox.classList.remove('accepted');
}
		renderRecapTables(data);
	} catch (error) {
		console.error("Erreur lors de la rÃ©cupÃ©ration des modules:", error);
	}
}


function renderRecapTables(data) {

	const tableBodyS1 = document.querySelector("#recap-table-s1 tbody");
	tableBodyS1.innerHTML = "";
	if (data.semester1.length === 0) {
		const tr = document.createElement("tr");
		tr.innerHTML = `<td colspan="3" style="text-align: center;">Aucun module attribuÃ© pour ce semestre</td>`;
		tableBodyS1.appendChild(tr);
	} else {
		data.semester1.forEach(row => {
			const tr = document.createElement("tr");
			tr.innerHTML = `
                     
        <td>${row.nom}</td>
        <td>${row.type}</td>
        <td>${row.heures}</td>
                    `;
			tableBodyS1.appendChild(tr);
		});
	}

	const tableBodyS2 = document.querySelector("#recap-table-s2 tbody");
	tableBodyS2.innerHTML = "";
	if (data.semester2.length === 0) {
		const tr = document.createElement("tr");
		tr.innerHTML = `<td colspan="3" style="text-align: center;">Aucun module attribuÃ© pour ce semestre</td>`;
		tableBodyS2.appendChild(tr);
	} else {
		data.semester2.forEach(row => {
			const tr = document.createElement("tr");
			tr.innerHTML = `
                        <td>${row.nom}</td>
                        <td>${row.type}</td>
                       <td>${row.heures}</td>
                    `;
			tableBodyS2.appendChild(tr);
		});
	}
	updateStats(data);
}


function updateStats(data) {
    totalHoursS1 = data.semester1.reduce((sum, module) => sum + parseInt(module.heures), 0);
    totalHoursS2 = data.semester2.reduce((sum, module) => sum + parseInt(module.heures), 0);

    // Compter les modules distincts par semestre (par nom)
    const uniqueModulesS1 = new Set(data.semester1.map(m => m.nom));
    const uniqueModulesS2 = new Set(data.semester2.map(m => m.nom));

    window.nbModulesS1 = uniqueModulesS1.size;
    window.nbModulesS2 = uniqueModulesS2.size;

    // Affichage initial (par dÃ©faut S1)
    document.getElementById('total-hours').textContent = `${totalHoursS1}h`;
    document.getElementById('modules-validated').textContent = `${window.nbModulesS1}`;
}

function showSemester(semesterId) {
    const semesterContents = document.querySelectorAll('.semester-content');
    semesterContents.forEach(content => {
        content.classList.remove('active');
    });

    document.getElementById(semesterId).classList.add('active');

    const buttons = document.querySelectorAll('.semester-btn');
    buttons.forEach(button => {
        button.classList.remove('active');
    });
    event.currentTarget.classList.add('active');

    if (semesterId === 'semester1') {
    document.getElementById('total-hours').textContent = `${totalHoursS1}h`;
    document.getElementById('modules-validated').textContent = `${window.nbModulesS1}`;
} else {
    document.getElementById('total-hours').textContent = `${totalHoursS2}h`;
    document.getElementById('modules-validated').textContent = `${window.nbModulesS2}`;
}
}

function openchat() {
	document.getElementById('negotiateModal').style.display = 'block';
	loadMessages();
}

function closeModal() {
	document.getElementById('negotiateModal').style.display = 'none';
}
    </script>
</body>
</html>